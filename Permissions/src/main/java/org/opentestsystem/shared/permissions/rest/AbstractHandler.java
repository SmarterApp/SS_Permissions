/*******************************************************************************
 * Educational Online Test Delivery System
 * Copyright (c) 2013 American Institutes for Research
 * 
 * Distributed under the AIR Open Source License, Version 1.0
 * See accompanying file AIR-License-1_0.txt or at 
 * http://www.smarterapp.org/documents/American_Institutes_for_Research_Open_Source_Software_License.pdf
 ******************************************************************************/
package org.opentestsystem.shared.permissions.rest;

import javax.servlet.http.HttpServletResponse;

import org.opentestsystem.shared.permissions.abstractions.IPermissionsPersister;
import org.opentestsystem.shared.permissions.exceptions.PermissionsPersistException;
import org.opentestsystem.shared.permissions.exceptions.PermissionsRetrievalException;
import org.opentestsystem.shared.permissions.rest.data.ReturnStatus;
import org.opentestsystem.shared.permissions.rest.data.StatusEnum;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.ResponseBody;

import AIR.Common.Web.HttpHandlerBase;

public abstract class AbstractHandler extends HttpHandlerBase
{
  private IPermissionsPersister _persister = null;

  @Autowired
  protected void setPersister (IPermissionsPersister value)
  {
    _persister = value;
  }

  protected IPermissionsPersister getPersister ()
  {
    return _persister;
  }

  @SuppressWarnings("rawtypes")
@ExceptionHandler (PermissionsRetrievalException.class)
  @ResponseBody
  public ReturnStatus handlePermissionsRetrievalException (PermissionsRetrievalException ex, HttpServletResponse response)
  {
    response.setStatus (HttpServletResponse.SC_INTERNAL_SERVER_ERROR);
    return new ReturnStatus (StatusEnum.FAILURE, ex.getMessage ());
  }

  @SuppressWarnings("rawtypes")
@ExceptionHandler (PermissionsPersistException.class)
  @ResponseBody
  public ReturnStatus handlePermissionsPersistException (PermissionsPersistException ex, HttpServletResponse response)
  {
    response.setStatus (HttpServletResponse.SC_INTERNAL_SERVER_ERROR);
    return new ReturnStatus (StatusEnum.FAILURE, ex.getMessage ());

  }
  
  protected void onBeanFactoryInitialized () {
  }
}
